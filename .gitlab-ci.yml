# 全量同步脚本 - 自动将代码推送到 GitHub
stages:
  - sync

sync_to_github:
  stage: sync
  image: alpine:latest
  before_script:
    - apk add git
    # 配置基础 Git 用户信息（防止报错）
    - git config --global user.email "sync@gitlab.com"
    - git config --global user.name "GitLab Sync Bot"
  script:
    # 1. 构造带 Token 的远程地址
    - GITHUB_REPO_URL="https://dakun333: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@github.com/dakun333/aquip.git"
    
    # 2. 检查并清理可能存在的旧远程分支
    - git remote remove github || true
    - git remote add github ${GITHUB_REPO_URL}
    
    # 3. 推送当前分支到 GitHub (强制覆盖确保同步)
    # CI_COMMIT_REF_NAME 是 GitLab 内置变量，代表当前提交的分支名
    - git push github HEAD:${CI_COMMIT_REF_NAME} --force